# 기능/요구사항 명세서 (상세)

---

## 1. 사용자 인증 (로그인/로그아웃)

- **입력**: ID(이메일/사번 등), 비밀번호
- **처리**:
	1. 입력값 유효성 검사 (빈 값, 포맷 체크)
	2. 로그인 버튼 클릭 시 `/api/auth/login` POST 요청 (body: {id, password})
	3. 서버에서 ID/비밀번호 검증, JWT 토큰 발급
	4. 성공 시 토큰 localStorage/sessionStorage 저장, 전역 상태 갱신
	5. 실패 시 에러 메시지 표시
- **출력**:
	- 성공: { token, userInfo, message: "로그인 성공" }
	- 실패: { error: "비밀번호가 틀렸습니다." }, { error: "존재하지 않는 계정입니다." }
- **예외/에러**:
	- ID/비번 미입력: "아이디와 비밀번호를 입력하세요."
	- 인증 실패(401): "계정 정보가 올바르지 않습니다."
	- 서버 오류(500): "서버에 문제가 발생했습니다."
- **UI/UX 흐름**: 로그인 성공 시 대시보드로 이동, 실패 시 입력창 shake 애니메이션 및 에러 안내
- **우선순위**: 필수

---

## 2. 버스 목록 조회/검색/필터링

- **입력**: (선택) 검색어, 상태(운행/정지), 페이지, 페이지 크기
- **처리**:
	1. 페이지 진입/검색 시 `/api/buses` GET 요청 (query: {search, status, page, size})
	2. 서버에서 조건에 맞는 버스 목록, 전체 개수 반환
	3. 프론트에서 표/카드 형태로 렌더링, 페이지네이션 처리
- **출력**:
	- { buses: [{id, bus_number, status, ...}], total: 120 }
- **예외/에러**:
	- API 실패: "버스 목록을 불러오지 못했습니다."
	- 네트워크 오류: "네트워크 연결을 확인하세요."
	- 빈 결과: "검색 결과가 없습니다."
- **UI/UX 흐름**: 검색/필터 입력 시 실시간 반영, 로딩 스피너, 에러 시 안내 배너
- **우선순위**: 필수

---

## 3. 버스 상세 보기

- **입력**: 버스 ID (URL 파라미터)
- **처리**:
	1. `/api/buses/:id` GET 요청
	2. 서버에서 해당 버스 상세 정보 반환
	3. 프론트에서 상세 모달/페이지에 정보 표시
- **출력**:
	- { id, bus_number, status, capacity, recent_schedules: [...], ... }
- **예외/에러**:
	- ID 없음(404): "해당 버스 정보를 찾을 수 없습니다."
	- API 실패: "버스 상세 정보를 불러오지 못했습니다."
- **UI/UX 흐름**: 목록에서 클릭 시 상세 모달 오픈, 에러 시 안내
- **우선순위**: 필수

---

## 4. 기사 목록/상세/검색

- **입력**: (선택) 검색어, 기사 ID, 페이지, 상태
- **처리**:
	1. `/api/drivers` GET (목록), `/api/drivers/:id` GET (상세)
	2. 검색/필터/페이지네이션 적용
	3. 상세 클릭 시 기사 정보, 배차 이력 등 표시
- **출력**:
	- 목록: { drivers: [{id, name, phone, status, ...}], total }
	- 상세: { id, name, phone, license, recent_schedules: [...] }
- **예외/에러**:
	- API 실패: "기사 정보를 불러오지 못했습니다."
	- ID 없음(404): "해당 기사를 찾을 수 없습니다."
- **UI/UX 흐름**: 검색/필터 실시간 반영, 상세 클릭 시 모달/페이지 이동
- **우선순위**: 필수

---

## 5. 스케줄 추가/수정/삭제

- **입력**: 버스ID, 기사ID, 출발/도착 시간, 노선, 비고 등
- **처리**:
	1. 입력값 유효성 검사(필수값, 시간 포맷, 중복 체크)
	2. `/api/schedules` POST(추가), PATCH(수정), DELETE(삭제) 요청
	3. 성공 시 목록 갱신, 실패 시 에러 안내
- **출력**:
	- 성공: { success: true, schedule: {...} }
	- 실패: { success: false, error: "중복된 스케줄입니다." }
- **예외/에러**:
	- 입력값 오류(400): "필수 정보를 입력하세요."
	- 중복(409): "이미 등록된 스케줄입니다."
	- API 실패: "스케줄 처리에 실패했습니다."
- **UI/UX 흐름**: 추가/수정/삭제 시 토스트 알림, 목록 자동 갱신, 에러 시 입력창 강조
- **우선순위**: 필수

---

## 6. 실시간 운행 현황(대시보드)

- **입력**: 없음 (자동)
- **처리**:
	1. WebSocket 연결(`/ws/operation` 등)
	2. 실시간 운행/배차 데이터 수신 및 파싱
	3. 대시보드 UI에 실시간 반영(차트, 리스트 등)
- **출력**:
	- { busId, status, location, driver, timestamp, ... }
- **예외/에러**:
	- 연결 실패: "실시간 데이터 연결에 실패했습니다."
	- 데이터 오류: "데이터 형식이 올바르지 않습니다."
	- 서버 다운: "서버와 연결이 끊어졌습니다."
- **UI/UX 흐름**: 연결 상태 표시(아이콘), 실시간 반영, 장애 시 재연결 시도 및 안내
- **우선순위**: 필수

---

## 7. 알림 목록/읽음 처리/실시간 알림

- **입력**: (선택) 페이지, 알림 ID, 읽음 여부
- **처리**:
	1. `/api/notifications` GET(목록), PATCH(읽음 처리)
	2. WebSocket으로 실시간 알림 수신
	3. UI에 알림 뱃지/리스트 표시, 읽음 처리 시 상태 변경
- **출력**:
	- { notifications: [{id, message, is_read, created_at, ...}], total }
- **예외/에러**:
	- API 실패: "알림 정보를 불러오지 못했습니다."
	- ID 없음(404): "해당 알림이 존재하지 않습니다."
- **UI/UX 흐름**: 새 알림 도착 시 뱃지 증가, 읽음 처리 시 실시간 반영, 에러 시 안내
- **우선순위**: 필수

---

## 8. 사용자 프로필 관리(정보/비밀번호 변경)

- **입력**: 이름, 연락처, 비밀번호, 프로필 이미지 등
- **처리**:
	1. 입력값 유효성 검사(포맷, 길이 등)
	2. `/api/users/me` PATCH(정보수정), `/api/users/me/password` PATCH(비번변경)
	3. 성공 시 상태/화면 갱신, 실패 시 에러 안내
- **출력**:
	- 성공: { success: true, user: {...} }
	- 실패: { success: false, error: "비밀번호가 일치하지 않습니다." }
- **예외/에러**:
	- 입력값 오류: "입력값을 확인하세요."
	- 인증 실패: "인증이 만료되었습니다. 다시 로그인하세요."
	- API 실패: "프로필 변경에 실패했습니다."
- **UI/UX 흐름**: 변경 성공 시 토스트, 실패 시 입력창 강조 및 안내
- **우선순위**: 선택

---

## 9. 통계/대시보드(운행/배차/기사 등)

- **입력**: 기간, 필터(버스/기사/상태 등)
- **처리**:
	1. `/api/statistics` GET 요청 (query: {from, to, type, ...})
	2. 서버에서 집계/가공 데이터 반환
	3. 프론트에서 차트/그래프 렌더링
- **출력**:
	- { chartData: [...], summary: {...} }
- **예외/에러**:
	- API 실패: "통계 데이터를 불러오지 못했습니다."
	- 데이터 없음: "해당 기간 데이터가 없습니다."
- **UI/UX 흐름**: 기간/필터 변경 시 실시간 반영, 로딩/에러 안내
- **우선순위**: 선택

---

## 10. 예외/에러 처리(전역)

- **입력**: 모든 입력/요청
- **처리**:
	1. 에러 발생 시 표준화된 메시지 생성
	2. 사용자에게 알림(토스트/배너/모달)
	3. 필요 시 재시도 버튼/자동 재시도, 로그 기록
- **출력**:
	- { error: "네트워크 오류가 발생했습니다." }
- **예외/에러**:
	- 네트워크 장애: "인터넷 연결을 확인하세요."
	- 서버 다운: "서버 점검 중입니다."
	- 인증 만료: "세션이 만료되었습니다. 다시 로그인하세요."
- **UI/UX 흐름**: 에러 발생 시 즉시 안내, 치명적 오류 시 로그인 화면 이동 등
- **우선순위**: 필수

---

> **참고:** 실제 구현에 따라 입력/출력 필드, 예외 상황, 처리 방식은 추가/수정될 수 있습니다. 각 기능별 상세 플로우/시나리오는 별도 문서로 분리해도 좋습니다.
