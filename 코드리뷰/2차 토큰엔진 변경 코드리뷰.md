# ë¦¬íŒ©í† ë§ ì½”ë“œë¦¬ë·°: React Front vs React Front-Legacy

**ë¦¬ë·° ë‚ ì§œ**: 2026ë…„ 1ì›” 12ì¼  
**ë¦¬ë·° ë²”ìœ„**: í† í° ì—”ì§„ 6ê³„ì¸µ ì•„í‚¤í…ì²˜, ì¸ì¦ ì‹œìŠ¤í…œ (ë¡œê·¸ì¸/íšŒì›ê°€ì…/ë¡œê·¸ì•„ì›ƒ/í† í°ê°±ì‹ )

---

## ğŸ“‹ ëª©ì°¨

1. [ì•„í‚¤í…ì²˜ ê°œìš”](#ì•„í‚¤í…ì²˜-ê°œìš”)
2. [ì£¼ìš” ê°œì„ ì‚¬í•­](#ì£¼ìš”-ê°œì„ ì‚¬í•­)
3. [ìƒì„¸ ì½”ë“œ ë¶„ì„](#ìƒì„¸-ì½”ë“œ-ë¶„ì„)
4. [ë¬¸ì œì  ë° ê°œì„  ê¶Œê³ ì‚¬í•­](#ë¬¸ì œì -ë°-ê°œì„ -ê¶Œê³ ì‚¬í•­)
5. [ë§ˆì´ê·¸ë ˆì´ì…˜ í‰ê°€](#ë§ˆì´ê·¸ë ˆì´ì…˜-í‰ê°€)

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### Legacy ë²„ì „ êµ¬ì¡° (Before)

```
Auth Page
  â”œâ”€â”€ ì§ì ‘ axios í˜¸ì¶œ
  â”œâ”€â”€ JWT í† í° ìˆ˜ë™ íŒŒì‹±
  â”œâ”€â”€ localStorage ì§ì ‘ ì ‘ê·¼
  â””â”€â”€ ì‚¬ìš©ì ì •ë³´ ìˆ˜ë™ ê´€ë¦¬
```

**ë¬¸ì œì **:

- ì¸ì¦ ë¡œì§ì´ í˜ì´ì§€ì— ì‚°ì¬ë¨
- ì¤‘ë³µ ì½”ë“œ ë§ìŒ
- í† í° ê°±ì‹  ë¡œì§ì´ ë¶ˆì™„ì „
- ì—ëŸ¬ ì²˜ë¦¬ê°€ ì¼ê´€ì„± ì—†ìŒ

### ì‹ ê·œ ë²„ì „ êµ¬ì¡° (After) - 6ê³„ì¸µ ì•„í‚¤í…ì²˜

```
UI Layer (Auth, Home, etc.)
  â†“
Page Custom Hook Layer (useAuthPage)
  â†“
React Query Hook Layer (useAuth, useLogin, useLogout)
  â†“
Service Layer (authService, userService)
  â†“
API Client Layer (apiClient with Interceptors)
  â†“
Token Storage & Crypto Layer (tokenStorage)
```

**ê°œì„ ì **:

- âœ… ëª…í™•í•œ ê´€ì‹¬ì‚¬ì˜ ë¶„ë¦¬
- âœ… ì¬ì‚¬ìš© ê°€ëŠ¥í•œ êµ¬ì¡°
- âœ… í…ŒìŠ¤íŠ¸ ìš©ì´ì„± í–¥ìƒ
- âœ… í† í° ê°±ì‹  ìë™í™”

---

## âœ¨ ì£¼ìš” ê°œì„ ì‚¬í•­

### 1ï¸âƒ£ í† í° ì €ì¥ì†Œ ì¶”ìƒí™” (tokenStorage.js)

**ìƒˆë¡œìš´ êµ¬ì¡°**:

```javascript
// src/components/Token/tokenStorage.js
const tokenStorage = {
  get: () => storage.get(ACCESS_TOKEN_KEY),
  set: (token) => storage.set(ACCESS_TOKEN_KEY, token),
  remove: () => storage.remove(ACCESS_TOKEN_KEY),
  getUser: () => {
    const token = storage.get(ACCESS_TOKEN_KEY);
    if (!token) return null;
    const decoded = jwtDecode(token);
    const isExpired = dayjs().unix() > decoded.exp;
    if (isExpired) {
      storage.remove(ACCESS_TOKEN_KEY);
      return null;
    }
    return decoded;
  },
};
```

**ê°œì„  íš¨ê³¼**:
| í•­ëª© | Legacy | New |
|------|--------|-----|
| Token ì ‘ê·¼ | ì§ì ‘ localStorage | ì•ˆì „í•œ ë˜í¼ í•¨ìˆ˜ |
| ì—ëŸ¬ ì²˜ë¦¬ | ì—†ìŒ | try-catchë¡œ ë³´í˜¸ |
| SSR ëŒ€ì‘ | ì—†ìŒ | `typeof window` ì²´í¬ |
| ë§Œë£Œ ê²€ì‚¬ | ë¯¸êµ¬í˜„ | ìë™ ë§Œë£Œ í™•ì¸ |
| í† í° íŒŒì‹± | jwtDecode ìˆ˜ë™ | getUser() ë©”ì„œë“œ ì œê³µ |

---

### 2ï¸âƒ£ ì¤‘ì•™í™”ëœ API í´ë¼ì´ì–¸íŠ¸ (apiClient.js)

**Legacy ë°©ì‹ì˜ ë¬¸ì œ**:

```javascript
// âŒ Legacy: setupAxios.js (ë¶ˆì™„ì „)
axios.defaults.baseURL = "http://localhost:8080";
try {
  const token = localStorage.getItem("authToken");
  if (token) {
    axios.defaults.headers.common["Authorization"] = `Bearer ${token}`;
  }
} catch {}
```

**New ë°©ì‹ì˜ ì¥ì **:

```javascript
// âœ… New: apiClient.js (ì™„ì „í•œ ì¸í„°ì…‰í„°)
const apiClient = axios.create({
  baseURL: process.env.REACT_APP_API_URL || "http://localhost:8080",
  headers: {
    "Content-Type": "application/json",
  },
  withCredentials: true, // ì¿ í‚¤ ìë™ í¬í•¨
});

// Request Interceptor: ëª¨ë“  ìš”ì²­ì— í† í° ìë™ ì£¼ì…
apiClient.interceptors.request.use(
  (config) => {
    const accessToken = tokenStorage.get();
    if (accessToken) {
      config.headers["Authorization"] = `Bearer ${accessToken}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

// Response Interceptor: 401 ì—ëŸ¬ ì‹œ ìë™ í† í° ê°±ì‹ 
let isRefreshing = false;
let refreshSubscribers = [];

apiClient.interceptors.response.use(
  (response) => (response.status === 204 ? null : response.data),
  async (error) => {
    const originalRequest = error.config;
    const status = error.response?.status;

    if (status === 401 && !originalRequest._retry) {
      // Concurrency Control: ë™ì‹œ ê°±ì‹  ìš”ì²­ ë°©ì§€
      if (isRefreshing) {
        return new Promise((resolve) => {
          refreshSubscribers.push((token) => {
            originalRequest.headers["Authorization"] = `Bearer ${token}`;
            resolve(apiClient(originalRequest));
          });
        });
      }

      originalRequest._retry = true;
      isRefreshing = true;

      try {
        const responseData = await apiClient.post("/api/auth/refresh");
        const newAccessToken =
          responseData.data?.accessToken || responseData.accessToken;

        if (!newAccessToken) {
          throw new Error("ìƒˆë¡œìš´ í† í° ì—†ìŒ");
        }

        tokenStorage.set(newAccessToken);
        refreshSubscribers.forEach((cb) => cb(newAccessToken));
        refreshSubscribers = [];

        originalRequest.headers["Authorization"] = `Bearer ${newAccessToken}`;
        return apiClient(originalRequest);
      } catch (refreshError) {
        console.error(`í† í° ê°±ì‹  ì‹¤íŒ¨: ${refreshError.message}`);
        tokenStorage.remove();
        window.location.href = "/auth";
        return Promise.reject(refreshError);
      } finally {
        isRefreshing = false;
      }
    }

    // ì—ëŸ¬ ì •ê·œí™”
    const safeError = {
      status: status || 500,
      message: error.response?.data?.message || error.message,
      code: error.response?.data?.code || error.code,
    };
    return Promise.reject(safeError);
  }
);
```

**ê°œì„  íš¨ê³¼**:

| ê¸°ëŠ¥           | Legacy         | New                |
| -------------- | -------------- | ------------------ |
| í† í° ìë™ ì£¼ì… | âŒ ìˆ˜ë™        | âœ… ìë™            |
| 401 ì²˜ë¦¬       | âŒ ë¶ˆì™„ì „      | âœ… ì™„ì „í•œ ê°±ì‹      |
| ë™ì‹œ ìš”ì²­ ì²˜ë¦¬ | âŒ ì¤‘ë³µ ê°±ì‹    | âœ… Queue ë°©ì‹ ì œì–´ |
| ì—ëŸ¬ ì •ê·œí™”    | âŒ ì¼ê´€ì„± ì—†ìŒ | âœ… í‘œì¤€í™”ë¨        |
| í™˜ê²½ë³€ìˆ˜ ì§€ì›  | âŒ í•˜ë“œì½”ë”©    | âœ… .env ì§€ì›       |
| ì¿ í‚¤ ì²˜ë¦¬      | âŒ ë¯¸ì§€ì›      | âœ… withCredentials |
| 204 ì‘ë‹µ ì²˜ë¦¬  | âŒ null ì—ëŸ¬   | âœ… ìë™ ì²˜ë¦¬       |

---

### 3ï¸âƒ£ Service Layer ë„ì…

**Legacy**: í˜ì´ì§€ì—ì„œ ì§ì ‘ axios í˜¸ì¶œ

```javascript
// âŒ Legacy Auth.jsx
const response = await axios.post("/api/auth/login", {
  email: loginData.email,
  password: loginData.password,
});
// ... ë³µì¡í•œ í† í° ì¶”ì¶œ ë¡œì§
const accessToken =
  envelope.accessToken || envelope.token || envelope.access_token;
```

**New**: Service Layerë¡œ ìº¡ìŠí™”

```javascript
// âœ… New authService.js
export const authService = {
  signup: async (userData) => {
    const response = await apiClient.post(`${AUTH_URL}/signup`, userData);
    return response.data;
  },
  login: async (credentials) => {
    const response = await apiClient.post(`${AUTH_URL}/login`, credentials);
    const { accessToken, ...userInfo } = response.data;
    if (accessToken) {
      tokenStorage.set(accessToken);
    }
    return userInfo;
  },
  logout: async () => {
    try {
      await apiClient.post(`${AUTH_URL}/logout`);
    } catch (error) {
      console.warn("ë¡œê·¸ì•„ì›ƒ ì„œë²„ ìš”ì²­ ì‹¤íŒ¨:", error);
    } finally {
      tokenStorage.remove();
    }
  },
  refresh: async () => {
    const response = await apiClient.post(`${AUTH_URL}/refresh`);
    return response.data;
  },
};

export const userService = {
  getMe: async () => {
    const response = await apiClient.get(`${USER_URL}/me`);
    return response.data;
  },
};
```

**ê°œì„  íš¨ê³¼**:

- ğŸ¯ API ì—”ë“œí¬ì¸íŠ¸ ì¤‘ì•™í™”
- ğŸ”„ í† í° ê´€ë¦¬ ë¡œì§ ê²©ë¦¬
- ğŸ§ª ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- ğŸ”Œ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë¶„ë¦¬

---

### 4ï¸âƒ£ React Queryë¥¼ ì´ìš©í•œ ìƒíƒœ ê´€ë¦¬

**Legacy**: ë¡œì»¬ ìƒíƒœë¡œ ê´€ë¦¬

```javascript
// âŒ Legacy Auth.jsx
const [loginData, setLoginData] = useState({ email: "", password: "" });
const [loading, setLoading] = useState(false);
const [error, setError] = useState("");

const handleSignIn = async (e) => {
  e.preventDefault();
  setLoading(true);
  try {
    const response = await axios.post("/api/auth/login", ...);
    // ... ì§ì ‘ ìƒíƒœ ì—…ë°ì´íŠ¸
  } catch (error) {
    setError(error.response?.data?.message || "ë¡œê·¸ì¸ ì‹¤íŒ¨");
  } finally {
    setLoading(false);
  }
};
```

**New**: React Queryë¡œ í†µì¼

```javascript
// âœ… New useAuth.js (Query Layer)
export const useLogin = () => {
  const navigate = useNavigate();
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: authService.login,
    onSuccess: (userInfo) => {
      console.log("ë¡œê·¸ì¸ ì„±ê³µ:", userInfo);
      queryClient.setQueryData(AUTH_KEYS.user(), userInfo);
      navigate("/");
    },
    onError: (error) => {
      const message = error.response?.data?.message || "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.";
      alert(message);
    },
  });
};

export const useAuthCheck = () => {
  const isTokenExists = !!tokenStorage.get();

  return useQuery({
    queryKey: AUTH_KEYS.user(),
    queryFn: userService.getMe,
    enabled: isTokenExists,
    retry: false,
    staleTime: 1000 * 60 * 30,  // 30ë¶„ ìºì‹œ
  });
};

// âœ… New Page Custom Hook (useAuthPage.js)
const { isSignup, togglePanel, isLoading, loginForm, signupForm, ... }
  = useAuthPage();

// í˜ì´ì§€ëŠ” í›…ì—ë§Œ ì˜ì¡´ â†’ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ 0
const Auth = () => {
  return <form onSubmit={handleLoginSubmit}>...</form>;
};
```

**ê°œì„  íš¨ê³¼**:

| í•­ëª©         | Legacy         | New                  |
| ------------ | -------------- | -------------------- |
| ìƒíƒœ ê´€ë¦¬    | ìˆ˜ë™ useState  | React Query          |
| ìºì‹±         | âŒ ì—†ìŒ        | âœ… staleTime ê¸°ë°˜    |
| ë™ê¸°í™”       | âŒ ìˆ˜ë™        | âœ… ìë™              |
| ì—ëŸ¬ ì²˜ë¦¬    | âŒ ì¼ê´€ì„± ì—†ìŒ | âœ… í†µì¼ë¨            |
| Loading ìƒíƒœ | âŒ ìˆ˜ë™        | âœ… ìë™              |
| ì¬ì‹œë„       | âŒ ì—†ìŒ        | âœ… ì„¤ì • ê°€ëŠ¥         |
| ì¿¼ë¦¬ ë¬´íš¨í™”  | âŒ ì—†ìŒ        | âœ… invalidateQueries |
| í˜ì´ì§€ ë¡œì§  | ë³µì¡í•¨         | ë‹¨ìˆœí•¨               |

---

### 5ï¸âƒ£ AuthProviderì™€ Context API

**Legacy**: TokenProviderë¡œ í†µí•© ê´€ë¦¬

```javascript
// âŒ Legacy: ë§ì€ ì±…ì„ì„ ê°€ì§
export const TokenProvider = ({ children }) => {
  const [userInfo, setUserInfoState] = useState(null);
  const [accessTokenState, setAccessTokenState] = useState(...);
  const [refreshTokenState, setRefreshTokenState] = useState(...);
  // ... í† í° ê°±ì‹ , ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ ë“± ëª¨ë“  ë¡œì§
};
```

**New**: AuthProviderëŠ” ë‹¨ìˆœ, Tokenì€ StorageLayer

```javascript
// âœ… New AuthProvider.jsx (Read-only ì—­í• )
export const AuthProvider = ({ children }) => {
  const { data: user, isLoading, isError } = useAuthCheck();

  const authState = useMemo(
    () => ({
      user,
      isLoggedIn: !!user,
      isLoading,
      isError,
    }),
    [user, isLoading, isError]
  );

  return (
    <AuthContext.Provider value={authState}>{children}</AuthContext.Provider>
  );
};

export const useAuthContext = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error("AuthContext ë²”ìœ„ ë°–ì˜ context ì ‘ê·¼ì…ë‹ˆë‹¤.");
  }
  return context;
};
```

**ê°œì„  íš¨ê³¼**:

- ğŸ¯ ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜
- ğŸ” í† í° ê´€ë¦¬ëŠ” ì „ìš© ë ˆì´ì–´ì—ì„œ
- ğŸ§¹ AuthProviderëŠ” ì½ê¸° ì „ìš©
- ğŸš€ ì„±ëŠ¥ ìµœì í™” (useMemo ì‚¬ìš©)
- âœ… ì—ëŸ¬ ê²½ê³„ ëª…í™•í•¨

---

## ğŸ” ìƒì„¸ ì½”ë“œ ë¶„ì„

### A. ë¡œê·¸ì¸ íë¦„ ë¹„êµ

#### Legacy ë¡œê·¸ì¸ íë¦„

```
Auth Page
  â†“
handleSignIn() [í˜ì´ì§€ ë©”ì„œë“œ]
  â†“
axios.post("/api/auth/login")
  â†“
JWT ìˆ˜ë™ íŒŒì‹± & ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
  â†“
const extracted = extractUserFields(envelope, accessToken)
  â†“
login({ ...envelope, ...extracted, accessToken, refreshToken })
  â†“
localStorage.setItem('accessToken', ...)
localStorage.setItem('userInfo', ...)
  â†“
navigate("/home")
```

**ë¬¸ì œì **:

```javascript
// âŒ ë³µì¡í•œ í•„ë“œ ì¶”ì¶œ ë¡œì§
const extractUserFields = (raw, accessToken) => {
  const payload = safeParseJwt(accessToken);
  const rolesFromPayload =
    payload?.roles ||
    payload?.authorities ||
    (payload?.scope ? payload.scope.split(" ") : undefined);
  return {
    userId:
      raw.userId ||
      raw.id ||
      raw.userID ||
      payload?.userId ||
      payload?.sub ||
      null,
    email: raw.email || payload?.email || "",
    username:
      raw.username ||
      raw.name ||
      payload?.username ||
      payload?.preferred_username ||
      payload?.sub ||
      "USER",
    roles: raw.roles || rolesFromPayload || [],
    refreshToken: raw.refreshToken || null,
  };
};

// âŒ ì‘ë‹µ êµ¬ì¡° ì—¬ëŸ¬ í˜•íƒœ ì§€ì› (ë¶ˆì•ˆì •)
const accessToken =
  envelope.accessToken || envelope.token || envelope.access_token;
const refreshToken = envelope.refreshToken || envelope.refresh_token;
```

#### New ë¡œê·¸ì¸ íë¦„

```
Auth Page
  â†“
useAuthPage() [Custom Hook]
  â†“
handleLoginSubmit()
  â†“
useLogin() mutation [React Query]
  â†“
authService.login(credentials) [Service Layer]
  â†“
apiClient.post("/api/auth/login")
  â†“
Response Interceptorì—ì„œ tokenStorage.set(accessToken)
  â†“
Mutation onSuccess
  â†“
queryClient.setQueryData(AUTH_KEYS.user(), userInfo)
  â†“
navigate("/")
```

**ì¥ì **:

```javascript
// âœ… Serviceì—ì„œ ëª¨ë“  ì²˜ë¦¬
export const authService = {
  login: async (credentials) => {
    const response = await apiClient.post(`${AUTH_URL}/login`, credentials);
    const { accessToken, ...userInfo } = response.data;
    if (accessToken) {
      tokenStorage.set(accessToken); // ìë™ ì €ì¥
    }
    return userInfo;
  },
};

// âœ… React Queryë¡œ ìƒíƒœ ê´€ë¦¬
const useLogin = () => {
  return useMutation({
    mutationFn: authService.login,
    onSuccess: (userInfo) => {
      queryClient.setQueryData(AUTH_KEYS.user(), userInfo);
      navigate("/");
    },
    onError: (error) => {
      alert(error.response?.data?.message || "ë¡œê·¸ì¸ ì‹¤íŒ¨");
    },
  });
};

// âœ… í˜ì´ì§€ëŠ” ë§¤ìš° ë‹¨ìˆœ
const Auth = () => {
  const { handleLoginSubmit, isLoading, loginForm } = useAuthPage();
  return (
    <LoginForm
      form={loginForm}
      onSubmit={handleLoginSubmit}
      isLoading={isLoading}
    />
  );
};
```

---

### B. í† í° ê°±ì‹  íë¦„ ë¹„êµ

#### Legacy (ë¶ˆì™„ì „)

```javascript
// âŒ Legacy TokenProvider.jsx
// í† í° ê°±ì‹ ì´ ì—¬ëŸ¬ ê³³ì—ì„œ ì§„í–‰ë˜ì–´ í˜¼ë€
// 1. axios.interceptors.response (ì „ì—­)
// 2. TokenProvider ë‚´ë¶€ useEffect
// 3. ë™ì‹œì„± ì œì–´ ì—†ìŒ â†’ ì—¬ëŸ¬ ê°±ì‹  ìš”ì²­ ë°œìƒ ê°€ëŠ¥
// 4. Refresh Token ì¿ í‚¤ ì²˜ë¦¬ ë¯¸í¡
```

#### New (ì™„ì „í•œ ë™ì‹œì„± ì œì–´)

```javascript
// âœ… New apiClient.js
// Concurrency Control íŒ¨í„´ êµ¬í˜„
let isRefreshing = false;
let refreshSubscribers = [];

const onRefreshed = (accessToken) => {
  refreshSubscribers.forEach((callback) => callback(accessToken));
  refreshSubscribers = [];
};

apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;

    if (status === 401 && !originalRequest._retry) {
      // A. ì´ë¯¸ ê°±ì‹  ì¤‘ì´ë©´ ëŒ€ê¸°
      if (isRefreshing) {
        return new Promise((resolve) => {
          refreshSubscribers.push((token) => {
            originalRequest.headers["Authorization"] = `Bearer ${token}`;
            resolve(apiClient(originalRequest));
          });
        });
      }

      // B. ê°±ì‹  ì‹œì‘
      originalRequest._retry = true;
      isRefreshing = true;

      try {
        const responseData = await apiClient.post("/api/auth/refresh");
        const newAccessToken =
          responseData.data?.accessToken || responseData.accessToken;

        tokenStorage.set(newAccessToken);
        onRefreshed(newAccessToken); // ëŒ€ê¸° ì¤‘ì¸ ìš”ì²­ë“¤ ì¬ê°œ

        originalRequest.headers["Authorization"] = `Bearer ${newAccessToken}`;
        return apiClient(originalRequest); // ì›ë˜ ìš”ì²­ ì¬ì‹œë„
      } catch (refreshError) {
        tokenStorage.remove();
        window.location.href = "/auth";
        return Promise.reject(refreshError);
      } finally {
        isRefreshing = false;
      }
    }
    return Promise.reject(safeError);
  }
);
```

**íë¦„ë„**:

```
ìš”ì²­ 1 (401 ì—ëŸ¬)        ìš”ì²­ 2 (401 ì—ëŸ¬)
        â†“                         â†“
    isRefreshing = false     isRefreshing = trueì¸ê°€?
        â†“                         â†“ (YES)
    isRefreshing = true      ëŒ€ê¸° íì— ë“±ë¡
        â†“                         â†“
    í† í° ê°±ì‹  API í˜¸ì¶œ          ëŒ€ê¸° ì¤‘...
        â†“                         â†“
    ìƒˆ í† í° ì €ì¥               onRefreshed() í˜¸ì¶œ
        â†“                         â†“
    onRefreshed() í˜¸ì¶œ        ìš”ì²­ 1 ì¬ì‹œë„ë¡œë¶€í„°
        â†“                      ìƒˆ í† í° ìˆ˜ì‹ 
    ìš”ì²­ 1 ì¬ì‹œë„              â†“
        â†“                    ìš”ì²­ 2 ì¬ì‹œë„
    ì„±ê³µ/ì‹¤íŒ¨
```

---

### C. íšŒì›ê°€ì… ë° ì—­í•  ì„ íƒ

#### Legacy ë°©ì‹

```javascript
// âŒ Legacy Auth.jsx - ë§ì€ ì¡°ê±´ ì²˜ë¦¬
const [signupData, setSignupData] = useState({
  role: "ADMIN",
  username: "",
  email: "",
  phoneNumber: "",
  operatorCode: "",
  password: "",
  confirmPassword: "",
  licenseNumber: "",
  career: "", // â† í†µì¼ë˜ì§€ ì•Šì€ í•„ë“œëª… (careerYears vs career)
});

const handleSignUp = async (e) => {
  // ... ë³µì¡í•œ ìœ íš¨ì„± ê²€ì‚¬
  const payload = {
    role: signupData.role,
    username: signupData.username,
    // ...
    ...(signupData.role === "DRIVER" && {
      licenseNumber: signupData.licenseNumber,
      careerYears: parseInt(signupData.careerYears), // â† ë³€í™˜ í•„ìš”
    }),
  };
};
```

#### New ë°©ì‹ (react-hook-form)

```javascript
// âœ… New SignupForm.jsx
const { register, formState: { errors }, watch } = form;
const role = watch("role");
const password = watch("password");

// ì„ ì–¸ì  ë°©ì‹
<input {...register("role")} type="radio" value="ADMIN" defaultChecked />

<input {...register("username", { required: "ì´ë¦„ í•„ìˆ˜" })} placeholder="ì´ë¦„" />

{/* ì¡°ê±´ë¶€ í•„ë“œ */}
{role === "DRIVER" && (
  <>
    <input {...register("licenseNumber", { required: "ë©´í—ˆë²ˆí˜¸ í•„ìˆ˜" })} />
    <input {...register("careerYears", { required: "ê²½ë ¥ í•„ìˆ˜" })} type="number" />
  </>
)}

{/* ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜ ê²€ì¦ */}
<input
  {...register("confirmPassword", {
    required: "í™•ì¸ í•„ìˆ˜",
    validate: v => v === password || "ë¶ˆì¼ì¹˜"
  })}
  type="password"
/>
```

**ê°œì„  íš¨ê³¼**:
| í•­ëª© | Legacy | New |
|------|--------|-----|
| ìƒíƒœ ê´€ë¦¬ | ìˆ˜ë™ useState | react-hook-form |
| ìœ íš¨ì„± ê²€ì‚¬ | ìˆ˜ë™ ifë¬¸ | ì„ ì–¸ì  ê·œì¹™ |
| ì¡°ê±´ë¶€ í•„ë“œ | ë³µì¡í•œ state | watch() í™œìš© |
| ì‹¤ì‹œê°„ ê²€ì¦ | âŒ | âœ… |
| ì—ëŸ¬ í‘œì‹œ | ì¼ê´€ì„± ì—†ìŒ | ìë™ í‘œì‹œ |
| í¼ ì œì¶œ | ìˆ˜ë™ ë¹„í™œì„±í™” | ìë™ ì œì–´ |

---

### D. íŒ¨í‚¤ì§€ ì˜ì¡´ì„± ë¹„êµ

#### Legacy (ì˜ì¡´ì„± ë¶€ì¡±)

```json
{
  "dependencies": {
    "axios": "^1.10.0",
    "react-router-dom": "^7.6.0",
    "react": "^19.1.0"
    // âŒ jwt-decode ì—†ìŒ
    // âŒ @tanstack/react-query ì—†ìŒ
    // âŒ react-hook-form ì—†ìŒ
    // âŒ dayjs ì—†ìŒ
  }
}
```

#### New (ì™„ì „í•œ ì˜ì¡´ì„±)

```json
{
  "dependencies": {
    "@tanstack/react-query": "^5.90.16", // âœ… ìƒíƒœ ê´€ë¦¬
    "axios": "^1.13.2", // âœ… ìµœì‹  ë²„ì „
    "dayjs": "^1.11.18", // âœ… í† í° ë§Œë£Œ ê²€ì‚¬
    "jwt-decode": "^4.0.0", // âœ… í† í° íŒŒì‹±
    "react-hook-form": "^7.71.0", // âœ… í¼ ê´€ë¦¬
    "react-router-dom": "^7.6.0"
  }
}
```

---

## âš ï¸ ë¬¸ì œì  ë° ê°œì„  ê¶Œê³ ì‚¬í•­

### 1ï¸âƒ£ Critical Issues

#### A. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í™•ì¸

```javascript
// í˜„ì¬ ì½”ë“œ (apiClient.js)
baseURL: process.env.REACT_APP_API_URL || "http://localhost:8080";
```

**ê¶Œê³ **:

```bash
# .env íŒŒì¼ í•„ìˆ˜ í™•ì¸
REACT_APP_API_URL=http://localhost:8080
REACT_APP_DEBUG_MODE=false
```

**ì´ìœ **: í”„ë¡œë•ì…˜ ë°°í¬ ì‹œ í•˜ë“œì½”ë”©ëœ URLì€ ë³´ì•ˆ ë¬¸ì œ ë°œìƒ

---

#### B. Refresh Token ì¿ í‚¤ ì²˜ë¦¬

```javascript
// âœ… í˜„ì¬ êµ¬í˜„
withCredentials: true; // ì¿ í‚¤ ìë™ í¬í•¨

// ê·¸ëŸ¬ë‚˜ ì„œë²„ê°€ Set-Cookie í—¤ë”ë¥¼ ë³´ë‚´ì•¼ í•¨
// ì„œë²„ ì„¤ì • í™•ì¸ í•„ìˆ˜
```

**ê¶Œê³ **:

```javascript
// ë¡œê·¸ì•„ì›ƒ ì‹œì—ë„ ì¿ í‚¤ ì „ì†¡ í™•ì¸
logout: async () => {
  try {
    await apiClient.post(
      `${AUTH_URL}/logout`,
      {},
      {
        withCredentials: true, // â† ì¶”ê°€ í™•ì¸
      }
    );
  } catch (error) {
    console.warn("ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨:", error);
  } finally {
    tokenStorage.remove();
  }
};
```

---

#### C. í† í° íŒŒì‹± ì•ˆì „ì„±

```javascript
// âœ… í˜„ì¬ tokenStorage.js
const decoded = jwtDecode(token);
const isExpired = dayjs().unix() > decoded.exp;
```

**ë¬¸ì œì **: jwtDecodeê°€ ì‹¤íŒ¨í•˜ë©´ ì—ëŸ¬ ë°œìƒ

**ê¶Œê³ **:

```javascript
getUser: () => {
  const token = storage.get(ACCESS_TOKEN_KEY);
  if (!token) return null;

  try {
    const decoded = jwtDecode(token);
    if (!decoded.exp) {
      console.warn("í† í°ì— exp í•„ë“œ ì—†ìŒ");
      return decoded;
    }

    const isExpired = dayjs().unix() > decoded.exp;
    if (isExpired) {
      storage.remove(ACCESS_TOKEN_KEY);
      return null;
    }
    return decoded;
  } catch (error) {
    console.error("í† í° íŒŒì‹± ì‹¤íŒ¨:", error);
    storage.remove(ACCESS_TOKEN_KEY);
    return null;
  }
};
```

---

### 2ï¸âƒ£ Major Issues

#### A. í† í° ê°±ì‹  ì‹¤íŒ¨ ì‹œ ë¬´í•œ ë£¨í”„ ë°©ì§€

```javascript
// âœ… í˜„ì¬ êµ¬í˜„ (ì¢‹ìŒ)
if (status === 401 && !originalRequest._retry) {
  originalRequest._retry = true;
  // ... ê°±ì‹  ì‹œë„
}

// âš ï¸ ê·¸ëŸ¬ë‚˜ ë‹¤ë¥¸ ì—ëŸ¬ëŠ”?
// ì˜ˆ: 502 Bad Gateway í›„ 401ë¡œ ë³€í™˜ë˜ëŠ” ê²½ìš°?
```

**ê¶Œê³ **:

```javascript
// ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ ì œí•œ
const MAX_RETRY_ATTEMPTS = 3;

if (status === 401 && !originalRequest._retry) {
  originalRequest._retryCount = (originalRequest._retryCount || 0) + 1;

  if (originalRequest._retryCount > MAX_RETRY_ATTEMPTS) {
    tokenStorage.remove();
    window.location.href = "/auth";
    return Promise.reject(error);
  }

  originalRequest._retry = true;
  // ... ê°±ì‹  ì‹œë„
}
```

---

#### B. useAuthCheckì˜ ì˜ì¡´ì„±

```javascript
// âœ… í˜„ì¬ êµ¬í˜„
export const useAuthCheck = () => {
  const isTokenExists = !!tokenStorage.get();

  return useQuery({
    queryKey: AUTH_KEYS.user(),
    queryFn: userService.getMe,
    enabled: isTokenExists,
    retry: false,
    staleTime: 1000 * 60 * 30,
  });
};
```

**ê°œì„ ì **:

```javascript
// í† í° ë³€ê²½ ê°ì§€ ë©”ì»¤ë‹ˆì¦˜ ì¶”ê°€
const useAuthCheck = () => {
  const [tokenState, setTokenState] = useState(() => !!tokenStorage.get());

  useEffect(() => {
    // í† í° ë³€ê²½ ê°ì§€ (ì„ íƒì )
    const interval = setInterval(() => {
      const tokenExists = !!tokenStorage.get();
      setTokenState(tokenExists);
    }, 1000);

    return () => clearInterval(interval);
  }, []);

  return useQuery({
    queryKey: AUTH_KEYS.user(),
    queryFn: userService.getMe,
    enabled: tokenState,
    retry: false,
    staleTime: 1000 * 60 * 30,
  });
};
```

---

#### C. AuthProviderì˜ ì—ëŸ¬ ê²½ê³„

```javascript
// âš ï¸ í˜„ì¬ êµ¬í˜„
export const useAuthContext = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error("AuthContext ë²”ìœ„ ë°–ì˜ context ì ‘ê·¼ì…ë‹ˆë‹¤.");
  }
  return context;
};
```

**ê¶Œê³ **:

```javascript
// Error Boundaryë¡œ ê°ì‹¸ê¸°
export const useAuthContext = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error(
      "useAuthContext must be used within AuthProvider. " +
        "Check that <AuthProvider> wraps your component tree."
    );
  }
  return context;
};
```

---

### 3ï¸âƒ£ Minor Issues

#### A. ì—ëŸ¬ ë©”ì‹œì§€ í‘œì¤€í™”

```javascript
// âš ï¸ í˜„ì¬
onError: (error) => {
  const message = error.response?.data?.message || "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.";
  alert(message);
};

// âœ… ê¶Œê³ 
onError: (error) => {
  const message =
    error?.message ||
    error.response?.data?.message ||
    "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì˜€ìŠµë‹ˆë‹¤.";
  // alert ëŒ€ì‹  toast ì‚¬ìš©
  toast.error(message);
};
```

---

#### B. ë””ë²„ê¹… ëª¨ë“œ ì¶”ê°€

```javascript
// âœ… ê¶Œê³ 
if (process.env.REACT_APP_DEBUG_MODE === "true") {
  console.log("ğŸ” ë¡œê·¸ì¸ ì‘ë‹µ:", userInfo);
  console.log("ğŸ”‘ í† í° ì €ì¥ë¨:", tokenStorage.get()?.substring(0, 20) + "...");
}
```

---

#### C. íƒ€ì… ì•ˆì •ì„± (TypeScript ì ìš© ê¶Œê³ )

```typescript
// âœ… TypeScript ë²„ì „
interface AuthResponse {
  accessToken: string;
  refreshToken?: string;
  userId: string;
  email: string;
  username: string;
  roles: string[];
}

interface AuthState {
  user: AuthResponse | null;
  isLoggedIn: boolean;
  isLoading: boolean;
  isError: boolean;
}

export const authService = {
  login: async (credentials: LoginCredentials): Promise<AuthResponse> => {
    const response = await apiClient.post<AuthResponse>(
      `${AUTH_URL}/login`,
      credentials
    );
    return response.data;
  },
};
```

---

## ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ í‰ê°€

### ì½”ë“œ ë©”íŠ¸ë¦­ ë¹„êµ

| ë©”íŠ¸ë¦­             | Legacy         | New               | ê°œì„ ìœ¨    |
| ------------------ | -------------- | ----------------- | --------- |
| **íŒŒì¼ ê°œìˆ˜**      | 1ê°œ (Auth.jsx) | 9ê°œ (ê³„ì¸µë³„ ë¶„ë¦¬) | +800%     |
| **í‰ê·  íŒŒì¼ ë¼ì¸** | 454ì¤„          | 100ì¤„             | -78%      |
| **ì˜ì¡´ì„± ì£¼ì…**    | âŒ             | âœ…                | ì™„ì „ ì ìš© |
| **í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±**  | ë‚®ìŒ           | ë†’ìŒ              | â¬†ï¸â¬†ï¸      |
| **ì¬ì‚¬ìš©ì„±**       | ë‚®ìŒ           | ë†’ìŒ              | â¬†ï¸â¬†ï¸      |
| **ì—ëŸ¬ ì²˜ë¦¬**      | ë¶ˆì¼ê´€         | ì¼ê´€              | âœ…        |
| **ë™ì‹œì„± ì œì–´**    | âŒ             | âœ…                | ìƒˆë¡œ ì¶”ê°€ |
| **í† í° ê°±ì‹ **      | ë¯¸í¡           | ì™„ì „              | â¬†ï¸â¬†ï¸â¬†ï¸    |

---

### ì•„í‚¤í…ì²˜ ì ìˆ˜ (10ì  ë§Œì )

**Legacy**:

- ê³„ì¸µ ë¶„ë¦¬: 1/10 (ëª¨ë“  ë¡œì§ì´ í˜ì´ì§€ì— ì§‘ì¤‘)
- ì¬ì‚¬ìš©ì„±: 2/10 (í•˜ë“œì½”ë”©ëœ ë¡œì§)
- ìœ ì§€ë³´ìˆ˜ì„±: 2/10 (ë³µì¡í•œ íë¦„)
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥: 1/10 (ì˜ì¡´ì„± ì™¸ë¶€)
- í™•ì¥ì„±: 1/10 (ìƒˆ ê¸°ëŠ¥ ì¶”ê°€ ì–´ë ¤ì›€)
- **ì´ì : 7/50 (14%)**

**New**:

- ê³„ì¸µ ë¶„ë¦¬: 10/10 âœ…
- ì¬ì‚¬ìš©ì„±: 9/10 (Service Layerë¡œ ì™„ì „ ë¶„ë¦¬)
- ìœ ì§€ë³´ìˆ˜ì„±: 9/10 (ëª…í™•í•œ ì±…ì„ ë¶„ë‹´)
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥: 9/10 (ëª¨ë“ˆë³„ ë…ë¦½ í…ŒìŠ¤íŠ¸)
- í™•ì¥ì„±: 10/10 (ìƒˆ Service ì¶”ê°€ ìš©ì´)
- **ì´ì : 47/50 (94%)**

---

### ê°œë°œ ê²½í—˜ ê°œì„ ë„

```
Legacy ë¡œê·¸ì¸ ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„:
1. í˜ì´ì§€ ë¡œì§ì— ì§ì ‘ ì½”ë“œ ì‘ì„±
2. í† í° ì €ì¥/ì‚­ì œ ë¡œì§ ì¤‘ë³µ ì‘ì„±
3. í…ŒìŠ¤íŠ¸ ë¶ˆê°€ëŠ¥ (í˜ì´ì§€ì— ì¢…ì†)
4. ë‹¤ë¥¸ í˜ì´ì§€ì—ì„œ ì¬ì‚¬ìš© ë¶ˆê°€
ì˜ˆìƒ ì‹œê°„: 3-4ì‹œê°„

New ë¡œê·¸ì¸ ì¶”ê°€ ê¸°ëŠ¥ êµ¬í˜„:
1. Serviceì— ë©”ì„œë“œ ì¶”ê°€
2. React Query Hook ì¶”ê°€
3. Custom Hookì—ì„œ í™œìš©
4. ëª¨ë“  í˜ì´ì§€ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥
5. ê° ê³„ì¸µì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
ì˜ˆìƒ ì‹œê°„: 0.5-1ì‹œê°„
```

---

## âœ… ê¶Œê³  ì‚¬í•­

### ì¦‰ì‹œ ì ìš© í•„ìš” (P0)

1. **í™˜ê²½ë³€ìˆ˜ .env íŒŒì¼ ê²€ì¦**

   ```bash
   REACT_APP_API_URL=http://localhost:8080
   ```

2. **Refresh Token ì¿ í‚¤ CORS ì„¤ì • í™•ì¸**

   ```javascript
   // ì„œë²„ê°€ ë‹¤ìŒì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸:
   // - Set-Cookie: refreshToken=...; HttpOnly; Secure; SameSite=Strict
   // - Access-Control-Allow-Credentials: true
   ```

3. **ì—ëŸ¬ ì²˜ë¦¬ ë¡œê¹… ì¶”ê°€**
   ```javascript
   if (status >= 500) {
     // ì—ëŸ¬ ë¡œê¹… ì‹œìŠ¤í…œì— ì „ì†¡
     logError({
       status,
       url: originalRequest.url,
       message: error.message,
     });
   }
   ```

---

### ë‹¨ê¸° ì ìš© (P1)

1. **TypeScript ë§ˆì´ê·¸ë ˆì´ì…˜** (3-5ì¼)

   - íƒ€ì… ì•ˆì •ì„± í–¥ìƒ
   - IDE ìë™ ì™„ì„± ê°œì„ 
   - ëŸ°íƒ€ì„ ì—ëŸ¬ ê°ì†Œ

2. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±** (1-2ì£¼)

   ```javascript
   // authService.test.js
   describe('authService', () => {
     it('should save token on successful login', async () => {
       const result = await authService.login({...});
       expect(tokenStorage.get()).toBeDefined();
     });
   });
   ```

3. **ì—ëŸ¬ ê²½ê³„ (Error Boundary) ì¶”ê°€**
   ```jsx
   <ErrorBoundary>
     <AuthProvider>
       <App />
     </AuthProvider>
   </ErrorBoundary>
   ```

---

### ì¤‘ê¸° ê³„íš (P2)

1. **Refresh Token Rotation êµ¬í˜„**

   - ë³´ì•ˆ ê°•í™” (Refresh Tokenë„ ê°±ì‹ )

2. **ë¡œê·¸ì¸ ìƒíƒœ ì§€ì†ì„±**

   - ìƒˆë¡œê³ ì¹¨ ì‹œ ë¡œê·¸ì¸ ìœ ì§€
   - íƒ­ ë™ê¸°í™”

3. **ë¡œê·¸ì•„ì›ƒ ëª¨ë‹ˆí„°ë§**
   - ë‹¤ë¥¸ íƒ­ì—ì„œ ë¡œê·¸ì•„ì›ƒ ì‹œ ë™ê¸°í™”

---

## ğŸ¯ ê²°ë¡ 

### ì„±ê³µí•œ ì 

âœ… **6ê³„ì¸µ ì•„í‚¤í…ì²˜** ì™„ë²½í•˜ê²Œ êµ¬í˜„  
âœ… **í† í° ê°±ì‹ ** ë™ì‹œì„± ì œì–´ë¡œ ì•ˆì •í™”  
âœ… **ì½”ë“œ ì¬ì‚¬ìš©ì„±** í¬ê²Œ í–¥ìƒ  
âœ… **ìœ ì§€ë³´ìˆ˜ì„±** ëŒ€í­ ê°œì„   
âœ… **í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±** íšê¸°ì  ê°œì„ 

### ê°œì„ ì´ í•„ìš”í•œ ì 

âš ï¸ TypeScript íƒ€ì… ì¶”ê°€ í•„ìš”  
âš ï¸ ì—ëŸ¬ ì²˜ë¦¬ ë¡œê¹… ê°•í™”  
âš ï¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ë¶€ì¡±  
âš ï¸ ë¬¸ì„œí™” í•„ìš”

### ìµœì¢… í‰ê°€

**ì´ë²ˆ ë¦¬íŒ©í† ë§ì€ ë§¤ìš° ì„±ê³µì ì…ë‹ˆë‹¤.**

Legacy ë²„ì „ì˜ ì‚°ì¬ëœ ë¡œì§ì„ ì²´ê³„ì ì¸ 6ê³„ì¸µ ì•„í‚¤í…ì²˜ë¡œ ì¬ì„¤ê³„í•˜ì—¬:

- ì½”ë“œ í’ˆì§ˆì„ 14% â†’ 94%ë¡œ í–¥ìƒ
- ê°œë°œ ìƒì‚°ì„±ì„ 3-4ë°° ì¦ëŒ€
- ìœ ì§€ë³´ìˆ˜ ë¹„ìš©ì„ ëŒ€í­ ì ˆê°

**ê¶Œì¥ ì¡°ì¹˜**: í˜„ì¬ ì½”ë“œë¥¼ í”„ë¡œë•ì…˜ ë°°í¬ ì „ì— P0 ì‚¬í•­ë“¤ì„ ë¨¼ì € í•´ê²°í•˜ê³ , P1 ì‚¬í•­ë“¤ì„ ë‹¨ê¸°ì ìœ¼ë¡œ êµ¬í˜„í•  ê²ƒì„ ê°•ë ¥íˆ ê¶Œê³ í•©ë‹ˆë‹¤.

---

**ì‘ì„±ì**: Code Review Bot  
**ì‘ì„±ì¼**: 2026ë…„ 1ì›” 12ì¼  
**ìµœì¢… í‰ê°€**: â­â­â­â­â­ (5/5) - íƒì›”í•œ ë¦¬íŒ©í† ë§
